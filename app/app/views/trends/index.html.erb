<div class="container-fluid py-4" 
     data-controller="trends"
     data-trends-university-schools-value='<%= @university_schools.to_json %>'
     data-trends-school-degrees-value='<%= @school_degrees.to_json %>'>
  <div class="row gx-4">
    <!-- Sidebar Filters -->
    <div class="col-lg-3">
      <div class="card shadow-sm border-0 sticky-top" style="top: 88px;">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Filters</h5>

          <!-- Field to visualise -->
          <!-- Dynamically generate and replace with a properly-formatted label -->
          <p class="text-muted mb-2 small">Select field to display</p>
          <div class="list-group list-group-flush mb-3" id="fieldFilters">
            <% @field_options.each_with_index do |field_option, i| %>
              <label class="list-group-item d-flex align-items-center gap-2">
                <input class="form-check-input me-1" 
                       type="radio" 
                       name="field" 
                       id="field<%= i+1 %>" 
                       value="<%= field_option[:value] %>" 
                       <%= 'checked' if i==0 %>
                       data-trends-target="fieldRadio"
                       data-action="change->trends#fieldChanged">
                <span><%= field_option[:label] %></span>
              </label>
            <% end %>
          </div>

          <!-- University Filter -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Select University</label>
            <select class="form-select" 
                    data-trends-target="universitySelect"
                    data-action="change->trends#universityChanged">
              <option value="">Select a university</option>
              <% @universities.each do |u| %>
                <option value="<%= u %>"><%= u %></option>
              <% end %>
            </select>
          </div>

          <!-- School Filter -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Select School</label>
            <select class="form-select" 
                    data-trends-target="schoolSelect"
                    data-action="change->trends#schoolChanged"
                    disabled>
              <option value="">Select a school</option>
            </select>
          </div>

          <!-- Degree Filter -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Select Degrees (up to 3 for comparison)</label>
            <select class="form-select" 
                    data-trends-target="degreeSelect"
                    multiple 
                    size="8" 
                    disabled>
              <option value="">Select degrees...</option>
            </select>
            <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple</small>
          </div>

          <!-- Apply Filters -->
          <button class="btn btn-primary w-100 mt-3" 
                  data-action="click->trends#updateChart">
            Apply Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Chart Area -->
    <div class="col-lg-9">
      <div class="trends-canvas">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 500px;">
          <canvas data-trends-target="canvas"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
